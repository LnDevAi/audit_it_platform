{
	"info": {
		"_postman_id": "e-defence-audit-platform",
		"name": "E-DEFENCE Audit Platform API",
		"description": "Collection compl√®te pour tester l'API de la plateforme E-DEFENCE Audit Platform",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "12345678"
	},
	"item": [
		{
			"name": "üîê Authentification",
			"item": [
				{
					"name": "Inscription Utilisateur",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\",\n  \"password\": \"{{test_password}}\",\n  \"firstName\": \"{{test_firstName}}\",\n  \"lastName\": \"{{test_lastName}}\",\n  \"organizationName\": \"{{test_organizationName}}\",\n  \"phone\": \"{{test_phone}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"register"
							]
						},
						"description": "Inscription d'un nouvel utilisateur avec cr√©ation automatique d'organisation"
					},
					"response": []
				},
				{
					"name": "Connexion Utilisateur",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    pm.environment.set('access_token', response.accessToken);",
									"    pm.environment.set('refresh_token', response.refreshToken);",
									"    pm.environment.set('user_id', response.user.id);",
									"    pm.environment.set('organization_id', response.user.organizationId);",
									"    console.log('Token sauvegard√©:', response.accessToken);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{test_email}}\",\n  \"password\": \"{{test_password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						},
						"description": "Connexion utilisateur et r√©cup√©ration des tokens"
					},
					"response": []
				},
				{
					"name": "Rafra√Æchir Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"refreshToken\": \"{{refresh_token}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/refresh",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"refresh"
							]
						},
						"description": "Rafra√Æchir le token d'acc√®s"
					},
					"response": []
				},
				{
					"name": "D√©connexion",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/auth/logout",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"logout"
							]
						},
						"description": "D√©connexion utilisateur"
					},
					"response": []
				}
			],
			"description": "Endpoints d'authentification et gestion des utilisateurs"
		},
		{
			"name": "üë• Gestion des Utilisateurs",
			"item": [
				{
					"name": "Obtenir Profil Utilisateur",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/users/profile",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"profile"
							]
						},
						"description": "R√©cup√©rer le profil de l'utilisateur connect√©"
					},
					"response": []
				},
				{
					"name": "Mettre √† Jour Profil",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"{{updated_firstName}}\",\n  \"lastName\": \"{{updated_lastName}}\",\n  \"phone\": \"{{updated_phone}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/users/profile",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"profile"
							]
						},
						"description": "Mettre √† jour le profil utilisateur"
					},
					"response": []
				},
				{
					"name": "Changer Mot de Passe",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"currentPassword\": \"{{current_password}}\",\n  \"newPassword\": \"{{new_password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/users/change-password",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users",
								"change-password"
							]
						},
						"description": "Changer le mot de passe de l'utilisateur"
					},
					"response": []
				},
				{
					"name": "Lister Utilisateurs (Admin)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/users?page=1&limit=10",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"users"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								}
							]
						},
						"description": "Lister les utilisateurs de l'organisation (Admin uniquement)"
					},
					"response": []
				}
			],
			"description": "Gestion des profils utilisateurs et des comptes"
		},
		{
			"name": "üè¢ Gestion des Organisations",
			"item": [
				{
					"name": "Obtenir D√©tails Organisation",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/organizations/{{organization_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"organizations",
								"{{organization_id}}"
							]
						},
						"description": "R√©cup√©rer les d√©tails de l'organisation"
					},
					"response": []
				},
				{
					"name": "Mettre √† Jour Organisation",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"{{updated_organization_name}}\",\n  \"address\": \"{{updated_organization_address}}\",\n  \"phone\": \"{{updated_organization_phone}}\",\n  \"email\": \"{{updated_organization_email}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/organizations/{{organization_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"organizations",
								"{{organization_id}}"
							]
						},
						"description": "Mettre √† jour les informations de l'organisation"
					},
					"response": []
				},
				{
					"name": "Obtenir Statistiques Organisation",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/organizations/{{organization_id}}/stats",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"organizations",
								"{{organization_id}}",
								"stats"
							]
						},
						"description": "R√©cup√©rer les statistiques de l'organisation"
					},
					"response": []
				}
			],
			"description": "Gestion des organisations et de leurs informations"
		},
		{
			"name": "üìã Missions d'Audit",
			"item": [
				{
					"name": "Cr√©er Mission d'Audit",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"{{audit_title}}\",\n  \"description\": \"{{audit_description}}\",\n  \"startDate\": \"{{audit_start_date}}\",\n  \"endDate\": \"{{audit_end_date}}\",\n  \"scope\": \"{{audit_scope}}\",\n  \"objectives\": [\"{{audit_objective_1}}\", \"{{audit_objective_2}}\"],\n  \"auditors\": [\"{{auditor_email_1}}\", \"{{auditor_email_2}}\"]\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/audit-missions",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"audit-missions"
							]
						},
						"description": "Cr√©er une nouvelle mission d'audit"
					},
					"response": []
				},
				{
					"name": "Lister Missions d'Audit",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/audit-missions?page=1&limit=10&status={{audit_status}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"audit-missions"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "status",
									"value": "{{audit_status}}"
								}
							]
						},
						"description": "Lister les missions d'audit avec filtres"
					},
					"response": []
				},
				{
					"name": "Obtenir Mission d'Audit",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/audit-missions/{{audit_mission_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"audit-missions",
								"{{audit_mission_id}}"
							]
						},
						"description": "R√©cup√©rer les d√©tails d'une mission d'audit"
					},
					"response": []
				},
				{
					"name": "Mettre √† Jour Mission d'Audit",
					"request": {
						"method": "PUT",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"{{updated_audit_title}}\",\n  \"description\": \"{{updated_audit_description}}\",\n  \"status\": \"{{updated_audit_status}}\",\n  \"progress\": {{updated_audit_progress}}\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/audit-missions/{{audit_mission_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"audit-missions",
								"{{audit_mission_id}}"
							]
						},
						"description": "Mettre √† jour une mission d'audit"
					},
					"response": []
				},
				{
					"name": "Supprimer Mission d'Audit",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/audit-missions/{{audit_mission_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"audit-missions",
								"{{audit_mission_id}}"
							]
						},
						"description": "Supprimer une mission d'audit"
					},
					"response": []
				}
			],
			"description": "Gestion compl√®te des missions d'audit"
		},
		{
			"name": "üìä Rapports et Export",
			"item": [
				{
					"name": "G√©n√©rer Rapport PDF",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"auditMissionId\": \"{{audit_mission_id}}\",\n  \"format\": \"pdf\",\n  \"includeCharts\": true,\n  \"includeRecommendations\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/reports/generate",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"reports",
								"generate"
							]
						},
						"description": "G√©n√©rer un rapport PDF d'audit"
					},
					"response": []
				},
				{
					"name": "Exporter Donn√©es Excel",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"dataType\": \"audit_missions\",\n  \"format\": \"excel\",\n  \"filters\": {\n    \"startDate\": \"{{export_start_date}}\",\n    \"endDate\": \"{{export_end_date}}\",\n    \"status\": \"{{export_status}}\"\n  }\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/exports/generate",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"exports",
								"generate"
							]
						},
						"description": "Exporter les donn√©es en format Excel"
					},
					"response": []
				},
				{
					"name": "T√©l√©charger Fichier",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/files/download/{{file_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"files",
								"download",
								"{{file_id}}"
							]
						},
						"description": "T√©l√©charger un fichier g√©n√©r√©"
					},
					"response": []
				}
			],
			"description": "G√©n√©ration de rapports et export de donn√©es"
		},
		{
			"name": "üìà Monitoring et M√©triques",
			"item": [
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"health"
							]
						},
						"description": "V√©rifier l'√©tat de sant√© de l'API"
					},
					"response": []
				},
				{
					"name": "Health Check D√©taill√©",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/health/detailed",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"health",
								"detailed"
							]
						},
						"description": "V√©rifier l'√©tat d√©taill√© de tous les services"
					},
					"response": []
				},
				{
					"name": "M√©triques Prometheus",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/metrics",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"metrics"
							]
						},
						"description": "R√©cup√©rer les m√©triques Prometheus"
					},
					"response": []
				},
				{
					"name": "Statistiques d'Utilisation",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/stats/usage",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"stats",
								"usage"
							]
						},
						"description": "R√©cup√©rer les statistiques d'utilisation"
					},
					"response": []
				}
			],
			"description": "Monitoring et m√©triques de l'application"
		},
		{
			"name": "üîß Administration",
			"item": [
				{
					"name": "Obtenir Configuration Syst√®me",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/config",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"config"
							]
						},
						"description": "R√©cup√©rer la configuration syst√®me (Admin uniquement)"
					},
					"response": []
				},
				{
					"name": "Nettoyer Cache",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/cache/clear",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"cache",
								"clear"
							]
						},
						"description": "Nettoyer le cache Redis (Admin uniquement)"
					},
					"response": []
				},
				{
					"name": "Optimiser Base de Donn√©es",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/admin/database/optimize",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"admin",
								"database",
								"optimize"
							]
						},
						"description": "Optimiser la base de donn√©es (Admin uniquement)"
					},
					"response": []
				}
			],
			"description": "Fonctions d'administration syst√®me"
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script de pr√©-requ√™te global",
					"console.log('Ex√©cution de la requ√™te:', pm.request.name);",
					"",
					"// V√©rifier si le token est expir√©",
					"const token = pm.environment.get('access_token');",
					"if (token) {",
					"    try {",
					"        const payload = JSON.parse(atob(token.split('.')[1]));",
					"        const expiration = payload.exp * 1000;",
					"        if (Date.now() >= expiration) {",
					"            console.log('Token expir√©, rafra√Æchissement n√©cessaire');",
					"        }",
					"    } catch (e) {",
					"        console.log('Erreur lors de la v√©rification du token');",
					"    }",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Script de test global",
					"pm.test('Status code is 200 or 201', function () {",
					"    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
					"});",
					"",
					"pm.test('Response time is less than 2000ms', function () {",
					"    pm.expect(pm.response.responseTime).to.be.below(2000);",
					"});",
					"",
					"pm.test('Response has required headers', function () {",
					"    pm.expect(pm.response.headers).to.have.property('content-type');",
					"    pm.expect(pm.response.headers).to.have.property('cache-control');",
					"});",
					"",
					"// Tests sp√©cifiques selon le type de requ√™te",
					"if (pm.request.method === 'POST') {",
					"    pm.test('POST request returns created resource', function () {",
					"        const response = pm.response.json();",
					"        pm.expect(response).to.have.property('id');",
					"    });",
					"}",
					"",
					"if (pm.request.method === 'GET') {",
					"    pm.test('GET request returns data', function () {",
					"        const response = pm.response.json();",
					"        pm.expect(response).to.not.be.null;",
					"    });",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:5000",
			"type": "string"
		},
		{
			"key": "test_email",
			"value": "test@e-defence.bf",
			"type": "string"
		},
		{
			"key": "test_password",
			"value": "TestPassword123!",
			"type": "string"
		},
		{
			"key": "test_firstName",
			"value": "John",
			"type": "string"
		},
		{
			"key": "test_lastName",
			"value": "Doe",
			"type": "string"
		},
		{
			"key": "test_organizationName",
			"value": "Test Organization",
			"type": "string"
		},
		{
			"key": "test_phone",
			"value": "+22670123456",
			"type": "string"
		}
	]
}


